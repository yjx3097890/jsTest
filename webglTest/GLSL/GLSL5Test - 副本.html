<!DOCTYPE html>
<html>
    <head>
        <title>three.js webgl - draggable cubes</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <style>
            body {
                font-family: Monospace;
                background-color: #000;
                margin: 0px;
                overflow: hidden;
            }
        </style>
        
       
    </head>
    <body>
        <script src="three.js"></script>
        <script type="text/javascript" src="fire.js"></script>    
        <script type="text/javascript" src="TrackballControls.js"></script>
            
        <!-- <script>
            //container是指页面放置这个webGL的一个层
            var container;
            //camera是指场景相机 controls是指控制器，比如一般的鼠标视角控制等  scene是场景，就好像一个大的舞台 
            //projector是可能指屏幕和场景转换工具 renderer是指场景渲染，能把场景呈现到浏览器里
            var camera, scene,renderer, controls;
           
            var  fire;
            //mouse，鼠标所对应的二维向量  offset 是指三维偏移向量  
            var mouse = new THREE.Vector2(),
             clock = new THREE.Clock(),
             SELECTED;
                
            //初始化整个场景
            init();
            //开始每秒最大60帧的渲染
            animate();
            
            function init() {
                //创建一个放置webGL的层
                container = document.createElement( 'div' );
                //把上面的层放到body里
                document.body.appendChild( container );
                //创建一个透视相机 可视角度70度 浏览器的全屏的宽高 水平视锥 最近1 最远10000 
                camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 1, 10000 );
                //相机的位置z正半轴3000
                camera.position.z = 3000;
                
                controls = new THREE.TrackballControls( camera );
                
                 //旋转速度
                controls.rotateSpeed = 1.0;
                //变焦速度
                controls.zoomSpeed = 1.2;
                //平移速度
                controls.panSpeed = 0.8;
                //是否不变焦
                controls.noZoom = false;
                //是否不平移
                controls.noPan = true;
                //可能是惯性 true没有惯性
                controls.staticMoving = false;
                //动态阻尼系数 就是灵敏度
                controls.dynamicDampingFactor = 0.3;
               
                //新建一个场景
                scene = new THREE.Scene();
             
              
                fire = new THREE.Fire(600,  new THREE.Vector3(2.5, 2.0, 1.5));
                
                fire.position.x = 1000;
                //把网格对象加到场景中
                scene.add( fire );
                    
               
                //创建一个抗锯齿的webgl渲染器
                renderer = new THREE.WebGLRenderer( { antialias: true } );
                //设置渲染的范围
                renderer.setSize( window.innerWidth, window.innerHeight );
               
                //把渲染成的所有页面标签加入到webgl层中
                container.appendChild( renderer.domElement );
                    
                    onWindowResize();
              
                //加入鼠标拖动对象的一系列监听事件
              renderer.domElement.addEventListener( 'mousemove', onDocumentMouseMove, false );
                renderer.domElement.addEventListener( 'mousedown', onDocumentMouseDown, false );
                renderer.domElement.addEventListener( 'mouseup', onDocumentMouseUp, false );
            
                //加入窗口改变大小时的监听事件
                window.addEventListener( 'resize', onWindowResize, false );
                
            }
            
            //窗口改变大小时的触发事件
            function onWindowResize() {
                //改变相机的aspect属性为当前窗口的宽高
                camera.aspect = window.innerWidth / window.innerHeight;
                //更新相机的投影矩阵
                camera.updateProjectionMatrix();
            
                //重新设置场景宽高
                renderer.setSize( window.innerWidth, window.innerHeight );
            
            }
                
            //当鼠标移动时触发的事件
            function onDocumentMouseMove( event ) {
            
                mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;
                mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;
            
                //新建一个三维变换半单位向量 假设z方向就是0.5,这样我左右移的时候，还会有前后移的效果
                var vector = new THREE.Vector3( mouse.x, mouse.y, 0.5 );
                    
                     var projector = new THREE.Projector();
                //屏幕和场景转换工具根据照相机，把这个向量从屏幕转化为场景中的向量
                projector.unprojectVector( vector, camera );
                
                //vector.sub( camera.position ).normalize()变换过后的向量vector减去相机的位置向量后标准化
                //新建一条从相机的位置到vector向量的一道光线
                var raycaster = new THREE.Raycaster( camera.position, vector.sub( camera.position ).normalize() );
            
                //是否有东西被选中
                if ( SELECTED ) {
                        var intersect = raycaster.intersectObject(fire);
                  
                        SELECTED.object.position.copy( intersect[0].point );
                    
                    return;
            
                }
            
            
            }
            //当鼠标按下时触发的事件
            function onDocumentMouseDown( event ) {
                //阻止本来的默认事件，比如浏览器的默认右键事件是弹出浏览器的选项
                event.preventDefault();
            
                var projector = new THREE.Projector();
                var vector = new THREE.Vector3( mouse.x, mouse.y, 0.5 );
                projector.unprojectVector( vector, camera );
            
                var raycaster = new THREE.Raycaster( camera.position, vector.sub( camera.position ).normalize() );
            
                var intersect = raycaster.intersectObject( fire );
                console.log(intersect);
                if ( intersect.length > 0 ) {
                    controls.enabled = false;
                    //把选中的对象放到全局变量SELECTED中
                    SELECTED = intersect[ 0 ]; 
                   
                    //改变鼠标的样式
                    container.style.cursor = 'move';
                }
            
            }
            
            function onDocumentMouseUp( event ) {
            
                event.preventDefault();
           
                controls.enabled = true;
                //选中物体置空
                SELECTED = null;
            
                
                //改变鼠标的样式
                container.style.cursor = 'auto';
            
            }
            
            //每秒最大60帧的渲染，一直在循环
            function animate() {
                //循环本身
                requestAnimationFrame( animate );
                //渲染场景
                render();
                
            }
            
            function render() {
                var delta = clock.getDelta();
               
               //	fire.time.value += delta ;  
                controls.update();
                //渲染场景和相机
                renderer.render( scene, camera );
            }
        </script> -->
    </body>
</html>
