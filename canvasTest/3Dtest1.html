<!DOCTYPE html>
<html>
	<head>
		<title>cube</title>
	</head>
    <body>
    	<canvas id="canvas" width="1300" height="600" style="border:1px solid #d3d3d3;"></canvas>
        <script type="text/javascript" src="Vector3.js"></script>
        <script type="text/javascript" src="wind-all-0.7.3.js"></script>
        <script type="text/javascript">
            var canvas, context,
                Points = [
                    new Vector3(100, 100, 100),
                    new Vector3(100, 100, -100),
                    new Vector3(-100, 100, -100),
                    new Vector3(-100, 100, 100),
                    new Vector3(-100, -100, 100),
                    new Vector3(-100, -100, -100),
                    new Vector3(100, -100, -100),
                    new Vector3(100, -100, 100)
                ],
                cameraPosition = new Vector3(0, 0, 700),
                distance = 500,
                ppoints, indices,
                alpha = 0;
                
            canvas = document.getElementById("canvas");
            context = canvas.getContext("2d");
            
            //使坐标变换到中心， y轴向上
            context.translate(canvas.width / 2, canvas.height / 2);
            context.scale(1, -1);
            indices = [[0,1,2,3], [0,3,4,7], [4,5,6,7], [1,6,5,2], [1,0,7,6], [3,2,5,4]];
            context.lineWidth = 2;
            
            //变换，画图
     //       ppoints = projection(Points, cameraPosition, distance);
    //        drawPoints(ppoints, indices);
            
            
 /*           var magnify = eval(Wind.compile("async", function () {
                while (distance < 1250 ) {
                    context.clearRect(-canvas.width / 2, -canvas.height / 2, canvas.width, canvas.height);
                     ppoints = projection(Points, cameraPosition, distance);
                    drawPoints(ppoints, indices);
                    distance += 10;
                    $await(Wind.Async.sleep(100));
                }
            }));
            
            var reduce = eval(Wind.compile("async", function () {
                while ( distance > 150 ) {
                   context.clearRect(-canvas.width / 2, -canvas.height / 2, canvas.width, canvas.height);
                     ppoints = projection(Points, cameraPosition, distance);
                    drawPoints(ppoints, indices);
                    distance -= 10;
                    $await(Wind.Async.sleep(100));
                }
            }));
            var execute = eval(Wind.compile("async", function () {
                $await(magnify());
                $await(reduce());
            }));
            execute().start();
 */ 

            var animate = eval(Wind.compile("async", function () {
                
                while (true) {
                    context.fillStyle = "#000";
                    context.fillRect(-canvas.width / 2, -canvas.height / 2, canvas.width, canvas.height);
                    context.strokeStyle = createColor();
                    
    //              distance += (10 - Math.random()*20);
                     alpha = 0.07;
                     for (var i=0, len = Points.length; i < len; i++) {
                        Points[i].rotate(alpha, "x").rotate(alpha, "y").rotate(alpha, "z");
                     }
                     
                    ppoints = projection(Points, cameraPosition, distance);
                    drawPoints(ppoints, indices);
                    $await(Wind.Async.sleep(100));
                }
            }));
            animate().start();
            
            
            function projection(points, cameraPosition, distance) {
                var i, len = points.length, result = [], point;
                for (i = 0; i < len; i++) {
                    point = points[i].clone();
                    point.x *= distance / Math.abs(cameraPosition.z - point.z);
                    point.y *= distance / Math.abs(cameraPosition.z - point.z);
                    result.push(point);
                }
                return result;
            }
            
            //按正方形画点，四个点一组
            function drawPoints(points, indices) {
                var i, len = indices.length, index = [0, 1, 2, 3];
                    context.beginPath();
                for (i=0; i<len; i++) {
                    index = indices[i];
                    context.moveTo(points[index[0]].x, points[index[0]].y);
                    context.lineTo(points[index[1]].x, points[index[1]].y);
                    context.lineTo(points[index[2]].x, points[index[2]].y);
                    context.lineTo(points[index[3]].x, points[index[3]].y);
                  //  context.closePath();
                }
                    context.stroke();
            }
            
              function createColor() {
                var c = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "a", "b", "c", "d", "e", "f"],
                    color = "#",
                    i = 0,
                    random = 0;
                for(i = 0;i < 6; i++){
                    random =  Math.random() * 16;
                    color += c[Math.floor(random)];
                }
                return color;
            }
        </script>
    </body>
</html>