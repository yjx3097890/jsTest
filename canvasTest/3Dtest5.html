<!DOCTYPE html>
<html>
	<head>
		<title>cube</title>
	</head>
    <body>
    	<canvas id="canvas" width="500" height="500" style="border:1px solid #d3d3d3;"></canvas>
        <script type="text/javascript" src="Vector3.js"></script>
        <script type="text/javascript">
            var canvas, context,
                i = 0 , x = 0, y = 0, k = 0, m = 200, n = 1000,
                cameraPosition = new Vector3(k, m, n),
                imageData = null,
                pixels = null, a, b, c , point;
                
            canvas = document.getElementById("canvas");
            context = canvas.getContext("2d");
            imageData = context.getImageData(0, 0, canvas.width, canvas.height);
            pixels = imageData.data;
            
            for (y=0; y < canvas.height; y++) {
                for (x = 0 ; x < canvas.width ; x++) {
                    a = x - canvas.width / 2;
                    b = -y + canvas.height / 2;
                    c = 0;
                    
                    point = getIntersectPoint (cameraPosition, new Vector3(a, b, c), new Vector3(0, - canvas.height / 2, 0), new Vector3(0, canvas.height / 2, 0));
                    
                    if ( point !== null && Math.abs(point.x) < canvas.width / 2 && point.z > -10000 && point.z < -100) {
                        pixels[i] = 111;
                        pixels[i+1] = 111;
                        pixels[i+2] = 255;
                        pixels[i+3] = 255 * (10000 + point.z) / 10000;
                    }
                    
                    point = getIntersectPoint (cameraPosition, new Vector3(a, b, c), new Vector3(- canvas.width / 2 , 0, 0), new Vector3( canvas.width / 2 , 0, 0));

                    if ( point !== null && point.z > -10000 && point.z < -100 && point.y > - canvas.height / 2 && point.y < 200) {
                        pixels[i] = 151;
                        pixels[i+1] = getRandomNum(163, 255);
                        pixels[i+2] = 5;
                        pixels[i+3] = 255 * (10000 + point.z) / 10000;
                    }

                    point = getIntersectPoint (cameraPosition, new Vector3(a, b, c), new Vector3(canvas.width / 2 , 0, 0), new Vector3( -canvas.width / 2 , 0, 0));  
                    
                    if ( point !== null && point.z > -10000 && point.z < -100 && point.y > - canvas.height / 2 && point.y < 200) {
                        pixels[i] = 151;
                        pixels[i+1] = getRandomNum(163, 255);
                        pixels[i+2] = 5;
                        pixels[i+3] = 255 * (10000 + point.z) / 10000;
                    }
                    
                    i += 4;
        
                }
            }
            context.putImageData(imageData, 0, 0);
            

            function isIntersectPlane (pointA, pointB, point, normal) {
                var directA = pointB.clone().sub(pointA),
                directB = pointA.clone().sub(point),
                directC = pointB.clone().sub(point);
                if ( directA.dot(normal) === 0 && directB.dot(normal) !== 0 ) {
                    return false;
                } else if ( directB.dot(normal) === 0 && directC.dot(normal) === 0 ){
                    console.warn("The two points are in the plane!");
                    return;
                }else {
                    return true;
                }
            }
            
            function getIntersectPoint (pointA, pointB, point, normal) {
                var direct = pointB.clone().sub(pointA).normalize(),
                t = 0,
                D = point.dot(normal);
                if ( isIntersectPlane(pointA, pointB, point, normal) ) {
                    t = (D - pointA.dot(normal)) / direct.dot(normal);
                    return pointA.clone().add(direct.multiplyScalar(t));
                } else {
                    return null;
                }
            }
            
            function getRandomNum (min, max) {
                return min + Math.random() * (max - min);
            }
            
              function createColor() {
                var c = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "a", "b", "c", "d", "e", "f"],
                    color = "#",
                    i = 0,
                    random = 0;
                for(i = 0;i < 6; i++){
                    random =  Math.random() * 16;
                    color += c[Math.floor(random)];
                }
                return color;
            }
        </script>
    </body>
</html>